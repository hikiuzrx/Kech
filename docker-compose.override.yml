version: '3.8'

services:
  # ... (existing services)

  # Shipement Tracker Service
  shipment-tracker:
    build:
      context: ./shipment_tracker
      dockerfile: Dockerfile
    container_name: smartwaste-shipment-tracker
    environment:
      SERVER_PORT: "8082"
      DB_HOST: postgres
      DB_PORT: "5432"
      DB_USER: postgres
      DB_PASSWORD: postgres
      DB_NAME: smartwaste_shipments
      NATS_URL: "nats://nats:4222"
      BLOCKCHAIN_RPC_URL: ${BLOCKCHAIN_RPC_URL}
      BLOCKCHAIN_PRIVATE_KEY: ${BLOCKCHAIN_PRIVATE_KEY}
    ports:
      - "8082:8082"
    depends_on:
      - postgres
      - nats
    networks:
      - smartwaste-network
    restart: unless-stopped

  # NATS Server
  nats:
    image: nats:2.10-alpine
    container_name: smartwaste-nats
    ports:
      - "4222:4222"
      - "8222:8222"
    command: [ "--jetstream", "--store_dir=/data" ]
    volumes:
      - nats_data:/data
    networks:
      - smartwaste-network

volumes:
  nats_data:
